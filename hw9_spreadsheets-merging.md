# Объединение данных из разных таблиц с помощью индексации

Предположим, мы хотим объединить две имеющиеся у нас таблицы в одну. Как это сделать? Сегодня мы разберем это на примере.

Возьмем частотные списки слов в из двух корпусов, [КРУТ](http://web-corpora.net/CoRST) и Русского учебного корпуса ([RLC](http://web-corpora.net/RLC)) - частотные списки обрезаны по частоте 3. 
Вот ссылка на [гугл-таблицу](https://docs.google.com/spreadsheets/d/16FKxnPqs8m6d4Lbn9nKVJw-oXfwn1LL_h78WGPd2AO8/edit?usp=sharing), с которой вы можете сделать себе копию (если же вы работаете в Excel, то можно скачать файл по [ссылке](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/%D0%9C%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D0%B0%D0%BB%D1%8B%20%D0%BB%D0%B5%D0%BA%D1%86%D0%B8%D0%B9%20%D0%B8%20%D1%81%D0%B5%D0%BC%D0%B8%D0%BD%D0%B0%D1%80%D0%BE%D0%B2/corpus_freq.xlsx) ).

Таблица `CorST`  

![таблица 1](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/images/1.png). 

Таблица `RLC`

![таблица 2](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/images/2.png)


Мы хотим получить общую таблицу, где данные из двух таблиц сведены вместе и их можно сравнить.

![14](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/images/14.png)    
Внимание, в получившейся таблице могут и должны будут встречаться **пустые ячейки**!

## Что нужно делать:
**Шаг 1.**

Добавим в таблицу `CorST` столбец "Номер строки, на которой слово стоит в RLC". 

![3](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/images/3.png)

**Шаг 2.**

Затем для каждого слова в таблице `CorST` нужно:
  * найти его в столбце "Слово" таблицы `RLC`
  * определить номер строки, на которой он стоит
  * записать этот номер в столбец "Номер..." таблицы `CorST`
  
Сделаем это с помощью формулы `=ПОИСКПОЗ(...)` (в английской версии `=MATCH(...)`).   
В Excel эту формулу можно найти на вкладке Формулы в разделе "Ссылки и массивы".   

![4](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/images/4.png)

В окне вставки формул укажем три аргумента:
  * Искомое_значение: кликните на ячейку с лексемой слева.
  * Просматриваемый массив: затем перейдите на лист таблицы `RLC` и выделите столбец "Слово"
  * Тип сопоставления: 0 (обозначает точное совпадение).

Нажмем OK.

![5](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/images/5.png)

В ячейке должен отобразиться номер строки, на которой искомое слово стоит в таблице `RLC`. Проверьте (с помощью поиска), что номер правильный.

Скопируем ячейку с формулой и вставим ее в том же столбце напротив всех остальных слов (можно дважды кликнуть на правый нижний угол заполненной ячейки, чтобы ее формула автоматически растянулась на весь столбец; выделение можно также растянуть на весь диапазон до конца таблицы, пользуясь комбинацией горячих клавиш `Shift` + `Ctrl` + стрелка вниз). 

![6](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/images/6.png)

**NB** Пересчет значений ячеек может занять некоторое время, особенно для больших таблиц.
Если после пересчета значений в каких-то ячейках появится #Н/Д (в английской версии - #N/A), это означает, что строка с таким словом не найдена.

**Шаг 3**

Добавим в таблицу `CorST` столбец "IPM-RLC". 

![7](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/images/7.png)

**Шаг 4**

На вкладке Формулы в разделе "Ссылки и массивы" найдем формулу "ИНДЕКС" (в английской версии "INDEX"), и в открывшемся мастере формулы:
   * выберите первую опцию

![8](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/images/8.png)

   * Массив: перейдите на лист `RLC` и выделите столбец с IPM.
   * Номер_строки: поставьте курсор на поле "Номер..." в таблице `CorST`
   * Номер_столбца: оставьте пустым, так как мы работаем с одним столбцом.

![9](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/images/9.png)

Нажмите ОК.

Проверьте (с помощью поиска), что частота для данного слова указана правильно.
Скопируем ячейку с формулой и вставим ее напротив всех остальных слов.

![10](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/images/10.png)

Теперь мы переставили все найденные данные из таблицы `RLC`. Осталось добавить те слова из `RLC`, которых не нашлось в основной таблице.

**Шаг 5**

Теперь все будет наоборот: добавим в таблицу `RLC` столбец "Номер строки, на которой слово стоит в CorST".

**Шаг 6**

Для каждого слова в таблице `RLC` найдем его позицию в столбце со словами таблицы `CorST` и запишем в столбце "Номер строки..." (так же, как в Шаге 2).

![11](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/images/11.png)

**Шаг 7**

Теперь мы хотим взять из таблицы `RLC` только те слова, которых не нашлось в списке `CorST`. 
Для этого отфильтруем все ячейки со значением "#Н/Д" в столбце "Номер строки...".

Делается это так:

  * Выделяем всю таблицу, нажав на ее левый верхний угол.
  * На вкладке "Данные" ищем функцию "Фильтр", нажимаем.
  * Выбираем нужную нам колонку "Номер строки, на которой слово стоит в CorST", нажав на небольшую белую кнопку справа от ее названия.
  * Создаем и применяем фильтр с условием "равно..." и значением "#Н/Д" (или "equals" "#N/A" в англоязычном интерфейсе).
  * Готово, теперь у нас остались только нужные слова!
 
Если отфильтровать слова почему-то не удалось, можно попробовать отсортировать их по значению столбца "Номер строки, на которой слово стоит в RLC". Так все слова со значением "#Н/Д" в этом столбце окажутся внизу или вверху таблицы, и их можно будет скопировать вручную.
  
![13](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/images/13.png)

Теперь добавим данные по этим словам в таблицу `CorST` (тут можно просто скопировать слова в столбец "Слова", внизу под существующим списком, а затем скопировать значения IPM в столбец `IPM-RLC`).
_Примечание_: если вам не удается вставить скопировать слова на другую вкладку, значит, вы пытаетесь вставить содержание целого столбца в часть другого столбца, что невозможно. Выделите именно диапазон ячеек от первого до последнего слова (и соответствующий диапазон частот).  

**Шаг 8** 

Теперь у нас в таблице `CorST` сведены все данные! 

Давайте выделим нужные нам данные в отдельный лист. Создадим лист "merge", вставим туда колонки Слово, IPM-CorST и IPM-RLC (используйте специальную вставку: только значений). В столбце IPM-RLC замените все вхождения #Н/Д на пустую строку. Укажите формат ячеек с IPM - числовой.

![14](https://github.com/ElizavetaKuzmenko/Programming-and-computer-instruments/blob/master/images/14.png) 

Отсортируйте таблицу по столбцу "Слово", а затем по столбцу "IPM-CorST".

**УРА!**

## Вопросы для проверки:
Ответы нужно писать в эту [форму](https://goo.gl/forms/rMQnG7v8mY6hmLtr2). 

1) Какие слова довольно частотны в RLC, но не встречаются в CorST? (приведите 6 самых частотных слов)

2) Какие слова, наоборот, частотны в CorST, но не встречаются в RLC? (приведите 6 самых частотных слов)

3) Различаются ли первые 10 слов в таблице, отсортированной по столбцу "IPM-CorST" по убыванию, и в таблице, отсортированной по столбцу "IPM_RLC" по убыванию?

## Полезное

* частотный словарь НКРЯ (современный русский язык): http://dict.ruslang.ru/freq.php 

* видовые пары глаголов по Грамматическому словарю А.А.Зализняка: [таблица](https://github.com/pykili/pykili.github.io/blob/master/_docs/lingdata/AspectualPairZalizniak.xls) 

* база данных синонимов русского языка: http://web-corpora.net/synonyms

* другие ресурсы школы лингвистики: http://web-corpora.net/ и https://linghub.ru/
